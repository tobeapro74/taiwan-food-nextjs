# 기능 명세서

## 1. 홈 화면

### 1.1 헤더
- 앱 타이틀 "🍜 대만맛집 🏯" 표시
- 우측 로그인/사용자 메뉴 버튼
  - 비로그인: 사용자 아이콘 (클릭 시 로그인 모달)
  - 로그인: 드롭다운 메뉴 (등록 히스토리, 비밀번호 변경, 로그아웃, 회원탈퇴)

### 1.2 검색바
- 실시간 자동완성 (1글자 이상)
- 최대 8개 검색 제안
- 맛집명, 위치, 야시장, 카테고리 검색 지원

### 1.3 화장실 찾기 버튼
- 홈 화면 상단에 고정 버튼
- 클릭 시 화장실 찾기 화면으로 이동

### 1.4 퀵 카테고리
- 가로 스크롤 카테고리 버튼
- 카테고리: 전체, 면류, 밥류, 탕류, 만두, 디저트, 길거리음식, 카페, 까르푸

### 1.5 인기 맛집
- 카테고리별 최고 평점 맛집 표시
- 가로 스크롤 카드 레이아웃
- 카테고리 배지 표시
- 실시간 Google 평점 연동

### 1.6 지역별 맛집 랭킹
- 타이베이 12개 구 + 신베이시 지역별 평균 평점 표시
- 상위 5개 지역 메달 표시 (🥇🥈🥉)
- "더보기" 클릭 시 전체 지역 랭킹 화면으로 이동
- 지역 클릭 시 해당 지역 맛집 목록 표시 (평점순 정렬)
- 최소 2개 이상 맛집이 있는 지역만 표시

### 1.7 야시장별 맛집
- 야시장 필터 버튼 (전체, 스린, 라오허제, 닝샤, 통화 등)
- 선택된 야시장의 맛집 목록 (최대 6개)
- 평점 높은 순 정렬

### 1.8 하단 네비게이션
- 홈, 카테고리, 야시장, 도심투어, 맛집알리미 탭
- 관리자/박병철: 맛집등록 탭 추가 표시

## 2. 타이베이 여행 가이드

### 2.1 접근 방법
- 홈 화면 상단 "📖 타이베이 여행 가이드" 버튼
- 그라데이션 스타일 (주황색)

### 2.2 컨텐츠 구성
- **타이베이에 대하여**: 타이베이시 vs 신베이시 비교
- **타이베이시 12개 구**: 각 구별 이모지 + 한줄 설명
- **타이베이시 주요 명소**: 101, 중정기념당, 시먼딩 등 7곳
- **신베이시 주요 명소**: 예류, 지우펀, 스펀 등 8곳

### 2.3 디자인
- MZ세대 친화적 UI
- 둥근 카드 스타일
- 이모지로 시각적 구분
- 다크모드 지원

## 3. 전체 지역별 맛집 랭킹

### 3.1 접근 방법
- 홈화면 "지역별 맛집 랭킹" 섹션의 "더보기" 클릭

### 3.2 표시 내용
- 전체 지역 랭킹 (평균 평점순)
- 메달 표시 (🥇🥈🥉 + 4위 이후 숫자)
- 지역명 (한글 + 영문)
- 지역 설명 일부
- 맛집 개수 + 평균 평점

### 3.3 상호작용
- 지역 카드 클릭 시 해당 지역 맛집 목록으로 이동
- 뒤로가기 버튼으로 홈 화면 복귀

## 4. 화장실 찾기

### 4.1 매장 선택
- 7-ELEVEN / FamilyMart 탭 선택
- 기본값: 7-ELEVEN

### 2.2 위치 기반 검색
- GPS 기반 현재 위치 자동 탐지
- 2km 반경 내 매장 검색
- 거리순 정렬 (가장 가까운 매장 우선)

### 2.3 결과 표시
- 최대 5개 매장 표시
- 매장명, 주소, 거리 표시
- "가장 가까움" 배지 (첫 번째 매장)
- 7-ELEVEN: ATM 유무 배지 표시, 화장실 개방 매장만 표시
- FamilyMart: 영업 상태 표시

### 2.4 길찾기
- 카드 클릭 시 Google Maps 길찾기 열기
- 도보 모드 기본값

### 2.5 데이터 동기화
- MongoDB에 매장 정보 저장
- Vercel Cron Job으로 일일 자동 동기화
  - 7-ELEVEN: 매일 22:00 UTC (공식 API 사용)
  - FamilyMart: 매일 23:00 UTC (Google Places API 사용)
- 타이베이시 12개 구 + 신베이시 29개 구 = 41개 구 지원

## 3. 카테고리/야시장/도심투어 선택

### 3.1 바텀 시트 UI
- 하단에서 올라오는 선택 시트
- 아이콘과 함께 옵션 목록 표시
- 선택 시 해당 목록 화면으로 이동

## 4. 맛집 목록 화면

### 4.1 헤더
- 뒤로가기 버튼 (44x44px 터치 영역)
- 목록 제목 (예: "면류 맛집", "스린야시장")

### 4.2 맛집 카드
- 이미지 (없으면 기본 이미지)
- 맛집명 (한글)
- 맛집명 (중문)
- 평점 (별표시 + 점수)
- 위치 정보
- 사용자 등록 맛집 배지

## 5. 맛집 상세 화면

### 5.1 이미지 갤러리
- 메인 이미지 표시
- Google Places 이미지 연동

### 5.2 기본 정보
- 맛집명 (한글/중문)
- 평점
- 영업 상태
- 주소
- 영업시간

### 5.3 추천메뉴
- 메뉴 목록 표시

### 5.4 Google 리뷰 섹션
- Google Places API 연동
- 평점 및 리뷰 수 표시
- 리뷰 내용 미리보기

### 5.5 사용자 리뷰 섹션
- 리뷰 목록 (최신순)
- 리뷰 작성 버튼

### 5.6 외부 링크
- Google Maps 열기
- Google 검색

### 5.7 맛집 정보 수정 (등록자/관리자)
- 카테고리 수정 버튼
- 맛집 정보 수정 버튼 (바텀시트 모달)
- 맛집 삭제 버튼 (등록자만)

### 5.8 데이터 동기화
- **상세 화면 진입 시 DB에서 최신 데이터 자동 fetch**
- 수정 후 즉시 화면 반영 (onUpdate 콜백)
- 뒤로가기 후 재진입해도 최신 데이터 유지

## 6. 회원 인증

### 6.1 회원가입
- 이름 입력
- 이메일 입력 (중복 체크)
- **이메일 인증 코드 발송** (Resend API)
- **6자리 인증 코드 확인** (10분 유효)
- 비밀번호 입력 (bcrypt 암호화)
- 관리자 등록 (관리자 시크릿 키 필요)

### 6.2 로그인
- 이메일/비밀번호 입력
- JWT 토큰 발급 (쿠키 저장)

### 6.3 로그아웃
- 쿠키 삭제

### 6.4 비밀번호 변경
- 현재 비밀번호 확인
- 새 비밀번호 입력

### 6.5 계정 삭제
- 비밀번호 확인 후 계정 영구 삭제
- 관련 리뷰 데이터도 함께 삭제

## 7. 리뷰 기능

### 7.1 리뷰 작성 (바텀시트 모달)
- **바텀시트 UI**: 아래에서 위로 슬라이드, 드래그 핸들 포함
- 전체 별점 (필수, 1~5점)
- 세부 별점 (선택)
  - 음식
  - 서비스
  - 분위기
- 리뷰 내용 (텍스트)
- 사진 첨부 (최대 4개)
  - 클라이언트 리사이즈 (800px, 60% 품질)
  - Cloudinary 업로드
- 식사 유형 선택 (아침/브런치/점심/저녁/기타)

### 7.2 리뷰 목록
- 작성자명
- 별점
- 작성일
- 리뷰 내용
- 사진 (있는 경우)

### 7.3 리뷰 수정
- 본인 리뷰만 수정 가능
- 기존 데이터 자동 로드
- 별점, 내용, 사진, 식사 유형 모두 수정 가능

### 7.4 리뷰 삭제
- 본인 리뷰만 삭제 가능
- 삭제 전 확인 모달 표시

## 8. PWA 지원

### 8.1 매니페스트
- 앱 이름: 대만맛집정보
- 테마 색상: #FF6B6B
- 홈 화면 추가 지원

### 8.2 아이콘
- 192x192, 512x512 PNG
- Apple Touch Icon

### 8.3 뷰포트 설정
- 모바일 최적화
- Safe Area 지원 (iOS 노치)

## 9. 기술적 특징

### 9.1 이미지 최적화
- 클라이언트 사이드 리사이즈
- JPEG 압축 (60% 품질)
- Cloudinary CDN 활용

### 9.2 반응형 디자인
- 모바일 퍼스트
- 최대 너비 md (448px) 제한
- 가로 스크롤 영역

### 9.3 성능 최적화
- Next.js App Router
- 정적 데이터 캐싱
- 이미지 lazy loading

## 10. 주변 맛집 찾기 (맛집알리미)

### 10.1 위치 설정
- GPS 기반 현재 위치 자동 탐지
- 주소 검색으로 위치 설정
- 수동 좌표 입력
- 미리 정의된 위치 선택 (주요 야시장, 관광지)

### 10.2 반경 설정
- 500m, 1km, 2km, 3km, 5km 선택 가능
- 기본값: 1km

### 10.3 결과 표시
- 거리순 정렬
- 거리 표시 (예: "350m")
- 맛집 카드 클릭 시 상세 페이지 이동

## 11. 네비게이션 UX

### 11.1 iOS 스타일 스와이프 뒤로가기
- 화면 왼쪽 가장자리에서 스와이프 시작
- 페이지 전체가 오른쪽으로 슬라이드
- 배경 어두워지는 오버레이 효과
- 스와이프 완료 시 페이지 밀어내기 애니메이션
- 스와이프 취소 시 부드러운 복귀

### 11.2 뒤로가기 버튼
- 44x44px 터치 영역 (Apple HIG 권장)
- 반투명 배경으로 가시성 확보
- 둥근 원형 디자인
- **모든 화면에서 동일한 스타일 (화장실 찾기 포함)**

### 11.3 네비게이션 히스토리 스택
- `viewHistory` 배열로 방문 화면 스택 관리
- 화면 이동 시 현재 화면을 스택에 push
- 뒤로가기 시 스택에서 pop하여 이전 화면으로 복귀
- 여러 단계 이동 후에도 정확한 뒤로가기 지원
```typescript
// 예시: 홈 → 전체랭킹 → 신이구 → 딩타이펑 → 뒤로가기
// 스택: [] → ["home"] → ["home", "district-ranking"] → ["home", "district-ranking", "list"]
// 뒤로가기: 딩타이펑 → 신이구 → 전체랭킹 → 홈
```

### 11.4 Safe Area 지원
- iOS 노치/다이나믹 아일랜드 대응
- 헤더 상단 여백 자동 조정

## 12. 사용자 맛집 등록

### 12.1 맛집 검색 (Google Places)
- Google Maps 장소 검색 연동
- 장소명, 주소, 좌표 자동 입력
- 평점, 리뷰 수, 가격대 자동 조회

### 12.2 카테고리 선택
- 면류, 만두, 밥류, 탕류, 디저트, 길거리음식, 카페
- 등록 후 카테고리 수정 가능 (등록자/관리자)

### 12.3 중복 등록 방지
- place_id 기반 중복 체크

### 12.4 등록 권한
- 관리자 또는 특정 사용자만 맛집 등록 가능
- 등록자, 관리자, 또는 박병철만 카테고리 수정 가능
- 등록자, 관리자, 또는 박병철만 삭제 가능

### 12.5 맛집 정보 수정
- 등록자, 관리자, 또는 박병철만 수정 가능
- 수정 가능 항목: 주소, 특징/메모, 전화번호, 영업시간, 카테고리
- 수정 전 확인 모달 표시
- 변경사항 히스토리 자동 기록

### 12.6 정적 데이터 자동 마이그레이션
- 정적 데이터(코드에 하드코딩된 맛집) 수정/삭제 시 자동으로 DB로 마이그레이션
- 마이그레이션 후 일반 사용자 등록 맛집과 동일하게 관리
- place_id 형식: `static_${맛집명}_${카테고리}`
- 예시: `static_딩타이펑_만두`, `static_융캉우육면_면류`
- 관리자 또는 박병철만 정적 데이터 수정/삭제 가능

### 12.7 정적 데이터 삭제 (Soft Delete)
- 정적 데이터 삭제 시 실제 삭제 대신 `deleted: true` 플래그 설정
- DB에 삭제 기록 유지 (복구 가능)
- 목록 조회 시 `deletedStaticIds` 배열로 삭제된 정적 데이터 필터링
- 삭제된 정적 데이터는 카테고리/야시장 목록에서 자동 제외

### 12.8 주소 편집 및 좌표 자동 변환
- 주소 입력 필드에서 직접 편집 가능
- **좌표 자동 변환**: 구글맵에서 복사한 좌표 붙여넣기 시 자동 주소 변환
  - 지원 형식: `(25.055701, 121.519953)` 또는 `25.055701, 121.519953`
  - Google Geocoding API로 역지오코딩
  - **Plus Code 반환**: `3F4M+5G6 大安區 臺北市 대만` 형식의 상세 주소 반환
- 변환된 주소로 Google Maps 검색 가능

## 13. 실시간 평점

### 13.1 평점 조회
- 맛집 목록에서 실시간 Google 평점 표시
- 평점 높은 순 자동 정렬
- 로딩 중 스피너 표시

### 13.2 캐싱
- 가격대/전화번호/건물명 클라이언트 캐싱
- 이미지 URL 캐싱
- API 응답 캐싱

## 14. 맛집 등록 히스토리

### 14.1 히스토리 목록
- 로그인 사용자 전용 기능
- 사용자 메뉴에서 "등록 히스토리" 접근
- 테이블 형태로 등록/수정/삭제 내역 표시

### 14.2 표시 정보
- 순번 (seq): 자동 증가 번호
- 날짜: 등록/수정/삭제 일시
- 맛집명: 등록된 맛집 이름 (클릭 시 상세 화면 이동)
- 지역: 간단한 주소 (구/동 단위)
- 카테고리: 맛집 카테고리
- 상태: 등록(녹색)/삭제(빨강)/수정(파랑) 배지

### 14.3 자동 기록
- 맛집 등록 시 자동으로 히스토리 생성
- 맛집 삭제 시 자동으로 히스토리 생성
- 카테고리 수정 시 자동으로 히스토리 생성
- 맛집 정보 수정 시 자동으로 히스토리 생성

### 14.4 페이지네이션
- 페이지당 20개 항목
- 최신순 정렬 (seq 내림차순)
- 이전/다음 페이지 네비게이션

### 14.5 반응형 레이아웃
- **모바일**: 카드 형식 레이아웃
  - 상단: 번호, 상태 배지, 카테고리 / 날짜(우측)
  - 중간: 맛집명 (클릭 시 상세 이동, 애니메이션 효과)
  - 하단: 지역, 메모
- **데스크탑**: 테이블 형식 레이아웃
  - 컬럼: #, 날짜, 맛집명, 지역, 카테고리, 상태
  - overflow-hidden으로 텍스트 겹침 방지

### 14.6 맛집 상세 이동
- 히스토리에서 맛집명 클릭 시 상세 화면으로 이동
- 삭제된 맛집은 클릭 불가 (취소선 표시)
- 상세 화면에서 뒤로가기 시 히스토리로 복귀

## 15. 모달 UX

### 15.1 바텀시트 모달 (맛집수정, 리뷰)
- **애니메이션**: 아래에서 위로 슬라이드 (slide-up, 0.3s)
- **드래그 핸들**: 상단 중앙에 회색 바 표시
- **배경 터치**: 배경 클릭 시 모달 닫힘
- **모서리**: 상단만 둥글게 (`rounded-t-3xl`)
- **최대 높이**: 85~90vh
- **Safe Area**: 하단 네비게이션바 고려 (`pb-[env(safe-area-inset-bottom)]`)

### 15.2 센터 모달 (로그인, 맛집등록, 비밀번호변경 등)
- **위치**: 화면 중앙
- **Safe Area**: 상하단 모두 고려
  - 상단: `pt-[calc(env(safe-area-inset-top)+16px)]`
  - 하단: `pb-[calc(env(safe-area-inset-bottom)+80px)]`
- **최대 높이**: `max-h-[calc(100vh-160px-env(safe-area-inset-top)-env(safe-area-inset-bottom))]`

### 15.3 배경 스크롤 방지
- 모든 모달에서 `document.body.style.overflow = "hidden"` 적용
- 모달이 열려있을 때 배경 스크롤 방지
- 모달 닫힐 때 `overflow` 원복

### 15.4 z-index 체계
- 하단 네비게이션: `z-[90]`
- 기본 모달: `z-[100]`
- 확인 모달 (중첩): `z-[110]`
- 회원탈퇴 모달: `z-[200]`

## 16. AI 여행 일정 생성

### 16.1 일정 생성
- 여행 일수 (1~14일)
- 인원 구성 (연령대별/성별)
- 취향 선택 (맛집, 카페, 쇼핑, 문화, 야경, 자연)
- 여행 목적 (맛집투어, SNS감성, 힐링, 쇼핑, 문화체험)
- 입국/출국 시간대 선택
- 숙소 지역 선택

### 16.2 일정 결과 화면
- 일차별 카드 (접기/펼치기)
- 시간대별 활동 표시 (오전/점심/오후/저녁/밤)
- 장소별 평점, 위치, 추천 이유, 꿀팁 표시
- 여행 팁 및 예상 예산 안내

### 16.3 사진 미리보기 모달
- **바텀시트 스타일**: RestaurantEditModal 패턴 적용
- **드래그 핸들**: 상단 중앙 회색 바
- **사진 그리드**: 2열 그리드 레이아웃
- **최대 10장** 사진 표시 (Google Places API 연동)
- **MongoDB 캐싱**: place_photos_cache 컬렉션에 저장

### 16.4 사진 전체화면 확대
- **라이트박스 UI**: 검은 배경 전체화면 오버레이
- **사진 네비게이션**:
  - 좌/우 화살표 버튼 (이전/다음 사진)
  - 키보드 지원 (← → ESC)
  - 사진 카운터 표시 (1/10)
- **닫기 버튼**: safe-area 고려 위치 조정 (터치 영역 48px)
- **배경 클릭**: 모달 닫기

### 16.5 일정 저장/관리
- 로그인 사용자만 저장 가능
- 저장된 일정 목록 화면
- 일정 상세 보기
- 일정 삭제 기능

### 16.6 네비게이션 연동
- 일정 화면에서 다른 탭(카테고리/야시장/등록) 클릭 시 해당 모달 표시
- 하단 네비게이션 z-index 조정으로 터치 영역 확보

## 17. 하단 네비게이션

### 17.1 기본 구조
- 고정 하단 바 (fixed bottom-0)
- safe-area-bottom 적용 (iOS 홈 인디케이터)
- z-index: `z-[90]` (일정 화면보다 위)

### 17.2 터치 영역
- 최소 버튼 크기: 56x52px
- 터치 피드백: `active:scale-[0.95] active:bg-muted/50`

### 17.3 탭 구성
- 홈, 주변맛집, 일정, 등록(관리자), 카테고리, 야시장
- 활성 탭: primary 색상
- 비활성 탭: muted-foreground
